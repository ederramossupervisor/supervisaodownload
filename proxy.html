<!DOCTYPE html>
<html>
<head>
    <title>Proxy - Sistema Supervis√£o</title>
</head>
<body>
    <script>
        // PROXY PARA APPS SCRIPT - SISTEMA SUPERVIS√ÉO
        console.log('üîß Proxy carregado - Aguardando requisi√ß√µes...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const targetUrl = urlParams.get('url');
        const data = urlParams.get('data');

        if (targetUrl && data) {
            console.log('üì® Processando requisi√ß√£o para:', targetUrl);
            
            // Fazer requisi√ß√£o REAL para o Apps Script (sem CORS)
            fetch(decodeURIComponent(targetUrl), {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: decodeURIComponent(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                return response.json();
            })
            .then(result => {
                console.log('‚úÖ Resposta recebida:', result);
                // Enviar resposta de volta para o PWA principal
                window.parent.postMessage({
                    type: 'PROXY_RESPONSE', 
                    result: result
                }, '*');
            })
            .catch(error => {
                console.error('‚ùå Erro no proxy:', error);
                window.parent.postMessage({
                    type: 'PROXY_ERROR', 
                    error: error.message
                }, '*');
            });
        } else {
            console.warn('‚ö†Ô∏è Par√¢metros ausentes');
            window.parent.postMessage({
                type: 'PROXY_ERROR', 
                error: 'Par√¢metros url e data s√£o obrigat√≥rios'
            }, '*');
        }
    </script>
</body>
</html>
